[package]
name = "nodus-enterprise"
version = "1.0.0"
description = "Nodus Enterprise - Complete Rust Migration with Automatic Observability and Defense-Grade Security"
authors = ["Nodus Team <team@nodus.dev>"]
license = "Commercial"
repository = "https://github.com/nodus/nodus-enterprise"
edition = "2021"
rust-version = "1.70"

[lib]
name = "nodus_enterprise"
crate-type = ["cdylib", "rlib"]

[[bin]]
name = "nodus-enterprise"
path = "src/main.rs"

[build-dependencies]
tauri-build = { version = "1.4", features = ["codegen"] }

[dependencies]
# Core Tauri dependencies
tauri = { version = "1.4", features = [
    "api-all",
    "cli",
    "dialog-all",
    "fs-extra",
    "http-all",
    "notification-all",
    "os-all",
    "path-all",
    "process-all",
    "protocol-asset",
    "shell-open",
    "system-tray",
    "updater",
    "window-all",
] }

# Async runtime and utilities
tokio = { version = "1.32", features = [
    "full",
    "macros",
    "rt-multi-thread",
    "signal",
    "sync",
    "time",
] }
tokio-util = { version = "0.7", features = ["full"] }
futures = "0.3"
async-trait = "0.1"

# Serialization and data handling
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
serde_yaml = "0.9"
toml = "0.8"
bincode = "1.3"

# Database and storage
sqlx = { version = "0.7", features = [
    "runtime-tokio-rustls",
    "postgres",
    "sqlite",
    "mysql",
    "uuid",
    "chrono",
    "json",
    "bigdecimal",
    "decimal",
] }
sea-orm = { version = "0.12", features = [
    "sqlx-postgres",
    "sqlx-sqlite", 
    "sqlx-mysql",
    "runtime-tokio-rustls",
    "macros",
    "with-chrono",
    "with-uuid",
    "with-json",
    "debug-print",
] }
redis = { version = "0.23", features = ["tokio-comp", "cluster"] }

# Cryptography and security
ring = "0.16"
rustls = { version = "0.21", features = ["dangerous_configuration"] }
rustls-webpki = "0.101"
x509-parser = "0.15"
webpki-roots = "0.25"
base64 = "0.21"
hex = "0.4"
argon2 = "0.5"
hmac = "0.12"
sha2 = "0.10"
aes-gcm = "0.10"
chacha20poly1305 = "0.10"
rand = "0.8"
rand_core = "0.6"

# Date and time
chrono = { version = "0.4", features = ["serde", "std"] }
time = { version = "0.3", features = ["serde", "formatting", "parsing"] }

# UUID generation
uuid = { version = "1.4", features = ["v4", "serde"] }

# Logging and tracing
tracing = { version = "0.1", features = ["log"] }
tracing-subscriber = { version = "0.3", features = [
    "env-filter",
    "fmt",
    "json",
    "registry",
    "std",
] }
tracing-opentelemetry = "0.21"
opentelemetry = { version = "0.20", features = ["rt-tokio"] }
opentelemetry-jaeger = { version = "0.19", features = ["rt-tokio"] }
log = "0.4"
env_logger = "0.10"

# HTTP client and server
reqwest = { version = "0.11", features = [
    "json",
    "rustls-tls",
    "cookies",
    "gzip",
    "brotli",
    "deflate",
    "stream",
] }
hyper = { version = "0.14", features = ["full"] }
axum = { version = "0.6", features = ["full"] }
tower = { version = "0.4", features = ["full"] }
tower-http = { version = "0.4", features = ["full"] }

# Configuration management
config = "0.13"
figment = { version = "0.10", features = ["toml", "yaml", "json", "env"] }

# Error handling
thiserror = "1.0"
anyhow = "1.0"
color-eyre = "0.6"

# Data structures and algorithms
dashmap = "5.5"
lru = "0.11"
indexmap = { version = "2.0", features = ["serde"] }
petgraph = "0.6"
bit-vec = "0.6"

# Networking and protocols
url = { version = "2.4", features = ["serde"] }
dns-lookup = "2.0"
socket2 = "0.5"
trust-dns-resolver = "0.23"

# Compression
flate2 = "1.0"
zstd = "0.12"
lz4_flex = "0.11"

# File system utilities
walkdir = "2.3"
notify = "6.1"
tempfile = "3.7"
dirs = "5.0"

# Image processing (for enterprise features)
image = { version = "0.24", features = ["jpeg", "png", "gif", "webp"] }

# Template rendering (for reports)
handlebars = "4.3"
tera = "1.19"

# CSV and data processing
csv = "1.2"
polars = { version = "0.32", features = ["lazy", "json", "csv-file", "parquet"] }

# Memory management and performance
jemallocator = { version = "0.5", optional = true }
mimalloc = { version = "0.1", optional = true }

# Platform-specific dependencies
[target.'cfg(windows)'.dependencies]
winapi = { version = "0.3", features = ["winuser", "winnt", "winsvc"] }
windows = { version = "0.51", features = ["full"] }

[target.'cfg(unix)'.dependencies]
nix = { version = "0.27", features = ["full"] }
libc = "0.2"

[target.'cfg(target_os = "macos")'.dependencies]
cocoa = "0.24"
objc = "0.2"

# Development dependencies for testing
[dev-dependencies]
tokio-test = "0.4"
mockall = "0.11"
proptest = "1.2"
criterion = { version = "0.5", features = ["html_reports"] }
tempfile = "3.7"
serial_test = "3.0"

# Features for different deployment configurations
[features]
default = [
    "enterprise",
    "automatic-observability",
    "defense-security",
    "multi-tenant",
    "compliance",
    "api-gateway",
    "plugin-system",
]

# Core feature sets
enterprise = []
community = []
defense = ["enterprise"]

# Security features
automatic-observability = []
defense-security = ["automatic-observability"]
classification-crypto = ["defense-security"]
mac-enforcement = ["defense-security"]
compartmented-security = ["defense-security"]

# Enterprise features
multi-tenant = ["enterprise"]
compliance = ["enterprise"]
api-gateway = ["enterprise", "multi-tenant"]
plugin-system = ["enterprise"]

# Performance features
jemalloc = ["dep:jemallocator"]
mimalloc = ["dep:mimalloc"]
performance-optimized = []

# Database features
postgres = []
mysql = []
sqlite = []

# Networking features
http2 = []
websockets = []
grpc = []

# Development features
dev-tools = []
debug-mode = []
hot-reload = []

# Platform features
windows-service = []
systemd-service = []
docker = []
kubernetes = []

# Compliance frameworks
sox-compliance = ["compliance"]
hipaa-compliance = ["compliance"]
gdpr-compliance = ["compliance"]
iso27001-compliance = ["compliance"]
nist-compliance = ["compliance", "defense"]
fedramp-compliance = ["compliance", "defense"]
fisma-compliance = ["compliance", "defense"]

[profile.dev]
debug = true
debug-assertions = true
overflow-checks = true
lto = false
panic = 'unwind'
incremental = true
codegen-units = 256
rpath = false

[profile.release]
debug = false
debug-assertions = false
overflow-checks = false
lto = true
panic = 'abort'
incremental = false
codegen-units = 1
strip = true
opt-level = 3

[profile.release-with-debug]
inherits = "release"
debug = true
strip = false

# Benchmark profile
[profile.bench]
debug = false
lto = true
codegen-units = 1
incremental = false

# Fast compilation for development
[profile.dev.package."*"]
opt-level = 2

# Workspace configuration
[workspace]
members = [
    ".",
    "crates/nodus-core",
    "crates/nodus-security", 
    "crates/nodus-observability",
    "crates/nodus-enterprise",
    "crates/nodus-cli",
]

[workspace.dependencies]
# Shared workspace dependencies
tokio = { version = "1.32", features = ["full"] }
serde = { version = "1.0", features = ["derive"] }
tracing = "0.1"
uuid = { version = "1.4", features = ["v4", "serde"] }
chrono = { version = "0.4", features = ["serde"] }

# Metadata for package distribution
[package.metadata.tauri]
bundle = true
updater = true

[package.metadata.tauri.targets]
all = true

[package.metadata.bundle]
name = "Nodus Enterprise"
identifier = "com.nodus.enterprise"
icon = ["icons/32x32.png", "icons/128x128.png", "icons/icon.icns", "icons/icon.ico"]
version = "1.0.0"
copyright = "Â© 2024 Nodus Technologies. All rights reserved."
category = "Productivity"
short_description = "Enterprise-grade data platform with automatic observability"
long_description = """
Nodus Enterprise is a comprehensive data platform featuring automatic observability,
defense-grade security, multi-tenant isolation, and enterprise compliance reporting.
Built with Rust for maximum performance and security.
"""

# Windows-specific bundle configuration
[package.metadata.bundle.windows]
msi = true
nsis = true

# macOS-specific bundle configuration  
[package.metadata.bundle.macos]
dmg = true
app = true

# Linux-specific bundle configuration
[package.metadata.bundle.linux]
appimage = true
deb = true
rpm = true

# Linting and code quality
[lints.rust]
unsafe_code = "forbid"
missing_docs = "warn"
unreachable_pub = "warn"
unused_qualifications = "warn"

[lints.clippy]
all = "warn"
pedantic = "warn"
nursery = "warn"
cargo = "warn"

# Documentation configuration
[package.metadata.docs.rs]
all-features = true
rustdoc-args = ["--cfg", "docsrs"]

# Binary distribution
[[package.metadata.dist]]
targets = [
    "x86_64-unknown-linux-gnu",
    "x86_64-pc-windows-msvc", 
    "x86_64-apple-darwin",
    "aarch64-apple-darwin",
]

# License and legal
[package.metadata.license]
file = "LICENSE"
badge = "https://img.shields.io/badge/license-Commercial-blue.svg"

# Changelog and versioning
[package.metadata.release]
pre-release-commit-message = "chore: Release {{version}}"
tag-message = "v{{version}}"
